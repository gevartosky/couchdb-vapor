name: Build on macOS and Ubuntu latest

on: [push]

env:
  COUCHDB_PASS: password

jobs:
#  macOS:
#    name: Build on macOS-latest
#    runs-on: macOS-latest
#        
#    steps:
#    - name: Print Swift version
#      run: swift --version
#      
#    - name: Checkout
#      uses: actions/checkout@master
#
#    - name: Swift build
#      run: swift build -c release
#            
#    - name: Done
#      run: echo Done
      
  ubuntu:
    name: Build on ubuntu-latest
    strategy:
      matrix:
        swift: [5.8.1] # [5.8.1, 5.7.3, 5.6.3]
    container: swift:${{matrix.swift}}
#    services:
#       couchdb:
#         image: couchdb
    runs-on: ubuntu-latest
    steps:
      - name: CouchDB in GitHub Actions
        uses: iamssen/couchdb-github-action@0.3.0
        with:
          couchdb-version: "latest" # optional, default is 3.1.0
          
      - name: Checkout
        uses: actions/checkout@master

#    - name: Swift build
#      run: swift build -c release

      - name: install curl
        run: |
          apt install -y curl
      
      - name: Swift test
        run: |
          curl -X POST -H "Content-Type: application/json; charset=utf-8" -d '{"name": "admin", "password": $COUCHDB_PASS}' http://127.0.0.1:5984/_session
            
      - name: Done
        run: echo Done
